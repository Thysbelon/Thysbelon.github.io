<!DOCTYPE html>
<html lang=en>
<head>
<meta charset=UTF-8>
<link rel=preload href=/ThysbelonTitle.svg as=image type=image/svg+xml>
<link rel=preload href=/thysbelonicon.svg as=image type=image/svg+xml>
<link rel=preload href=/BlogStylesheet.css as=style>
<meta name="color-scheme" content="dark light"><link rel=alternate hreflang=ja href=https://thysbelon.github.io/ホーム/><title>Thysbelon</title>
<meta name=theme-color content=#ff4c60>

<meta name=viewport content=width=device-width,initial-scale=1.0>
<meta name="description" content="My personal blog where I post about whatever interests me."><script src=/ytvideoactivate.js></script><link rel=icon type=image/x-icon href=/thysbelonicon.svg>
<link rel=stylesheet href=/BlogStylesheet.css></head>
<body>
<header><img id=blogtitle src=/ThysbelonTitle.svg alt=Thysbelon. width=1002 height=272><img src=/thysbelonicon.svg alt="Logo of a Hummingbird moth." width=280 height=280></a></header>
<nav><ul><li><a href=/About/>About</a><li><a href=/Archive/>Archive</a><li><a href=/Subscribe/>Subscribe</a><li><a href=/Portfolio/>Portfolio</a><li><details><summary>Art</summary><ul><li><a href=/Programs/>Programs</a><li><a href=/Photography/>Photography</a><li><a href=/Digital-Art/>Digital Art</a></details>
	<li><a href=/>Language/言語</a></ul></nav>
<article><h1><a href=/2023/03/07/How-to-Convert-DSZ-and-4GS-save-files-to-SAV>How to Convert DSZ and 4GS save files to SAV</a></h1><time> 7 March 2023</time><p>44670's two great web emulator ports: <a href=https://gba.44670.org/ target=_blank>44gba</a> and <a href=https://ds.44670.org/ target=_blank>DS Player</a>, both use a completely unique file extension for their save files; Here's how to convert these formats to .sav: <h2>4GS</h2> <p>This is just a renamed version of the emulator Visual Boy Advance's srm save format. <p>To convert it to sav: <ol> <li>Rename it to change the <code>.4gs</code> extension to <code>.srm</code>, and remove all spaces from the file name. <li>Use gbaconv to convert </ol> <p>I was going to compile gbaconv to WebAssembly using Emscripten, so that even...</article><article><h1><a href=/2023/01/23/Looping-N64-Midi>Looping N64 Midi</a></h1><time>23 January 2023</time><link href=/misc/headbop.css rel=stylesheet>
<a href=/2023/01/23/Looping-N64-Midi tabindex=-1><img loading=lazy class=trans src=/misc/headbopsheet.png id=bopmoth4 alt="A hummingbird moth wearing headphones."></a>
<button onclick=this.onclick=null;StartJams4() style=margin-bottom:1rem>Start Jams</button>
<p>The previous two N64 midis had blank space after the end of the loop, so I cut off the blank space so I could cleanly loop the song when the player stopped. However, I learned today that N64SoundbankTool exported midis will have their loop start and end points marked by a CC 102 and 103 event. I used js-synthesizer's hook midi method to automatically loop the song at those positions; it was easy to do and it turned out great!
<script src=https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/externals/libfluidsynth-2.3.0-with-libsndfile.js></script><script src=https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/dist/js-synthesizer.min.js></script>
<script>
var sfontBuffer;
var smfBuffer;
var context = new AudioContext();

function StartJams4(){
console.log('startjams4');

(async function(){
	let response = await fetch('/2023/01/23/Looping-N64-Midi/../ExtractedSoundbank.sf3');
	sfontBuffer = await response.arrayBuffer();
	response = await fetch('/2023/01/23/Looping-N64-Midi/../Kirby 64 - The Crystal Shards (U) 00000007 0025C274.mid');
	smfBuffer = await response.arrayBuffer();
})();

async function createReverb() { // from mdn
  let convolver = context.createConvolver();

  // load impulse response from file
  let response = await fetch('/misc/ElvedenHallSmokingRoom.m4a'); // from http://reverbjs.org/Library/ElvedenHallSmokingRoom.m4a
  let arraybuffer = await response.arrayBuffer();
  convolver.buffer = await context.decodeAudioData(arraybuffer);

  return convolver;
}

JSSynth.waitForReady().then(loadSynthesizer);

async function loadSynthesizer() {
	
	context.resume();
	await context.audioWorklet.addModule('https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/externals/libfluidsynth-2.3.0-with-libsndfile.js')
	await context.audioWorklet.addModule('https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/dist/js-synthesizer.worklet.min.js');
	await context.audioWorklet.addModule('/misc/N64-midi-loop.js');
	var synth = new JSSynth.AudioWorkletNodeSynthesizer();
	synth.init(context.sampleRate);
	var audioNode = synth.createAudioNode(context);
	synth.hookPlayerMIDIEventsByName('n64Loop');
	
	// goes with mdn code
	let reverb = await createReverb();
	audioNode.connect(reverb);
	//var gain = new GainNode(context,{gain:3})
	let gain = new GainNode(context,{gain:0.1});
	reverb.connect(gain);
	gain.connect(context.destination);
	audioNode.connect(context.destination);
	
	await synth.loadSFont(sfontBuffer);
	await synth.addSMFDataToPlayer(smfBuffer);
	let tempelem=document.getElementById('bopmoth4')
	await synth.playPlayer();
	tempelem.style.animation=(60/174)*2+"s step-end infinite bop"
	/*while (jams2===true) {
		console.log("loop")
		await synth.waitForPlayerStopped()
		await synth.seekPlayer(1440)
		await synth.playPlayer();
	}*/
	
}

}
</script></article><article><h1><a href=/2023/01/22/Redial>Redial</a></h1><time>22 January 2023</time><link href=/misc/headbop.css rel=stylesheet>
<a href=/2023/01/22/Redial tabindex=-1><img loading=lazy class=trans src=/misc/headbopsheet.png id=bopmoth3 alt="A hummingbird moth wearing headphones."></a>
<button onclick=this.onclick=null;StartJams3() style=margin-bottom:1rem>Start Jams</button>
<p>Today I put a midi of Redial on the web! :)
<p>To get it more accurate, I had to <a href=/2023/01/22/Redial/../redial.mid>move Channel 10 to Channel 9</a> (so it would be on a melodic channel) and increase the pitch bend range of the flute (<a href=https://github.com/mmontag/chip-player-js/commit/c7bd02fa4607a3e667915335b5b8c35e4c954e8d#diff-b3ec3a9bee19be17cac48aec8418a919b740104572a2caf5b331efc7aab7f92eR228 target=_blank>mmontag figured this out first</a> and provided a <a href=https://www.polyphone-soundfonts.com/forum/soundfonts-help/346-how-to-set-pitch-bend-range-to-12-semitones target=_blank>source</a>). I also made a <a href=/2023/01/22/Redial/../redial-echo.mid>second midi</a> that echos the melodic instruments, and applied a little reverb to both. I also had to <a href=/2023/01/22/Redial/../ExtractedSoundbank-Instr_0D-increaseDecay.7z>increase the decay on the keyboard</a> because it was going quiet too soon (<a href=/2023/01/19/Success-with-N64-Sequenced-Music>a lot like last time</a>).
<script src=https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/externals/libfluidsynth-2.3.0-with-libsndfile.js></script><script src=https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/dist/js-synthesizer.min.js></script>
<!--<script src=http://reverbjs.org/reverb.js></script>-->
<script>
var sfontBuffer;
var smfBuffer;
var smfBuffer2;
var context = new AudioContext();

function StartJams3(){
console.log('startjams3');

(async function(){
	let response = await fetch('/2023/01/22/Redial/../ExtractedSoundbank-Instr_0D-increaseDecay.sf3');
	sfontBuffer = await response.arrayBuffer();
	response = await fetch('/2023/01/22/Redial/../redial.mid');
	smfBuffer = await response.arrayBuffer();
	response = await fetch('/2023/01/22/Redial/../redial-echo.mid');
	smfBuffer2 = await response.arrayBuffer();
})();

async function createReverb() { // from mdn
  let convolver = context.createConvolver();

  // load impulse response from file
  let response = await fetch('/misc/ElvedenHallSmokingRoom.m4a'); // from http://reverbjs.org/Library/ElvedenHallSmokingRoom.m4a
  let arraybuffer = await response.arrayBuffer();
  convolver.buffer = await context.decodeAudioData(arraybuffer);

  return convolver;
}

JSSynth.waitForReady().then(loadSynthesizer);

async function loadSynthesizer() {
	
	context.resume();
	await context.audioWorklet.addModule('https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/externals/libfluidsynth-2.3.0-with-libsndfile.js')
	await context.audioWorklet.addModule('https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/dist/js-synthesizer.worklet.min.js');
	var synth = new JSSynth.AudioWorkletNodeSynthesizer();
	synth.init(context.sampleRate);
	var audioNode = synth.createAudioNode(context);
	
	synth2 = new JSSynth.AudioWorkletNodeSynthesizer();
	synth2.init(context.sampleRate);
	var audioNode2 = synth2.createAudioNode(context);
	//audioNode2.connect(context.destination);
	//await synth2.loadSFont(sfontBuffer)
	//await synth2.addSMFDataToPlayer(smfBuffer2);
	
	// goes with mdn code
	let reverb = await createReverb();
	let gain = new GainNode(context,{gain:0.2});
	reverb.connect(gain);
	gain.connect(context.destination);
	
	let music=new GainNode(context,{gain:1})
	audioNode.connect(music);
	audioNode2.connect(music);
	music.connect(reverb);
	music.connect(context.destination)
	
	await synth.loadSFont(sfontBuffer);
	await synth.addSMFDataToPlayer(smfBuffer);
	await synth2.loadSFont(sfontBuffer);
	await synth2.addSMFDataToPlayer(smfBuffer2);
	let tempelem=document.getElementById('bopmoth3')
	await synth.playPlayer();
	await synth2.playPlayer();
	tempelem.style.animation=(60/155.026)*2+"s step-end infinite bop"
	while (true) {
		console.log("loop")
		await synth.waitForPlayerStopped()
		await synth.seekPlayer(16*960)
		await synth2.seekPlayer(16*960)
		await synth.playPlayer();
		await synth2.playPlayer();
	}
	
}

}
</script></article><article><h1><a href=/2023/01/19/Success-with-N64-Sequenced-Music>Success with N64 Sequenced Music</a></h1><time>19 January 2023</time><link href=/misc/headbop.css rel=stylesheet>
<a href=/2023/01/19/Success-with-N64-Sequenced-Music tabindex=-1><img loading=lazy class=trans src=/misc/headbopsheet.png id=bopmoth2 alt="A hummingbird moth wearing headphones."></a>
<button onclick=this.onclick=null;StartJams2() style=margin-bottom:1rem>Start Jams</button>
<p>Remember when I said I would never attempt to embed N64 sequenced music on a webpage again? I lied. I just had to give it another try! I wanted to see what kind of results I would get by using a midi extracted via <a href=https://github.com/jombo23/N64-Tools target=_blank>N64 Soundbank Tool</a>. There were some errors I had to fix, but it sounds pretty good! Not perfect, of course, but it's recognizable.
<details>
<summary>
Fixes
</summary>
<p>I had to change the sustain level of the bass instrument in the soundfont, so the sound wouldn't go quiet immediately. <a href=/2023/01/19/Success-with-N64-Sequenced-Music/../ExtractedSoundbank-instr_20-vol_envelope-sustain_level.7z>Fixed soundfont (use 7zip to extract).</a> I also added reverb.
</details>
<p>The most difficult part was recreating the reverb heard in game. I tried a bunch of weird module things, but all I really needed was to play a convolverNode reverb output <em>alongside</em> the unmodified output. <!--<br>Thank you to <a href=http://reverbjs.org/ target=_blank>Reverb.js</a> for making that even easier to do!-->
<p>(Please don't click "Start Jams" twice)
<script src=https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/externals/libfluidsynth-2.3.0-with-libsndfile.js></script><script src=https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/dist/js-synthesizer.min.js></script>
<!--<script src=http://reverbjs.org/reverb.js></script>-->
<script>
var sfontBuffer;
var smfBuffer;
var jams2;
var context = new AudioContext();

function StartJams2(){
console.log('startjams2');

(async function(){
	let response = await fetch('/2023/01/19/Success-with-N64-Sequenced-Music/../ExtractedSoundbank-instr_20-vol_envelope-sustain_level.sf3');
	sfontBuffer = await response.arrayBuffer();
	response = await fetch('/2023/01/19/Success-with-N64-Sequenced-Music/../Super Smash Bros. (U) 0000000A 00B379FC cut.mid');
	smfBuffer = await response.arrayBuffer();
})();

async function createReverb() { // from mdn
  let convolver = context.createConvolver();

  // load impulse response from file
  let response = await fetch('/misc/ElvedenHallSmokingRoom.m4a'); // from http://reverbjs.org/Library/ElvedenHallSmokingRoom.m4a
  let arraybuffer = await response.arrayBuffer();
  convolver.buffer = await context.decodeAudioData(arraybuffer);

  return convolver;
}

JSSynth.waitForReady().then(loadSynthesizer);

async function loadSynthesizer() {
	
	context.resume();
	await context.audioWorklet.addModule('https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/externals/libfluidsynth-2.3.0-with-libsndfile.js')
	await context.audioWorklet.addModule('https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/dist/js-synthesizer.worklet.min.js');
	var synth = new JSSynth.AudioWorkletNodeSynthesizer();
	synth.init(context.sampleRate);
	var audioNode = synth.createAudioNode(context);
	
	
	// goes with mdn code
	let reverb = await createReverb();
	audioNode.connect(reverb);
	//var gain = new GainNode(context,{gain:3})
	let gain = new GainNode(context,{gain:0.2});
	reverb.connect(gain);
	gain.connect(context.destination);
	audioNode.connect(context.destination);await synth.loadSFont(sfontBuffer);
	await synth.addSMFDataToPlayer(smfBuffer);
	let tempelem=document.getElementById('bopmoth2')
	await synth.playPlayer();
	tempelem.style.animation="0.75949367088607594936708860759494s step-end infinite bop"
	jams2=true
	while (jams2===true) {
		console.log("loop")
		await synth.waitForPlayerStopped()
		await synth.seekPlayer(1440)
		await synth.playPlayer();
	}
	
}

}
</script></article><article><h1><a href=/2023/01/18/Trouble-with-N64-Sequenced-Music>Trouble with N64 Sequenced Music</a></h1><time>18 January 2023</time><p>DLS files are really tough to work with. The only thing that can convert them is Viena. I've been extracting soundbanks from N64 games, but N64SoundbankTool only extracts them as DLS; so when I convert the DLS to SF2 and play it with the N64-music-converted-to-midi, I can't tell how many of the flaws are from the DLS conversion, and how many are from the N64 extraction... (They're probably the fault of the N64 extraction) <br>and I don't think I'll be able to find a way to play DLS files on...</article><div class=pnav><a class="btnlink fri" href=/Home/page/2/>Older Posts</a></div>
<footer>Header font from <a href=http://velvetyne.fr/fonts/compagnon/ target=_blank>Velvetyne</a></footer>
<script src=/webpnotice.js></script></body></html>