<!DOCTYPE html>
<html lang=en>
<head>
<meta charset=UTF-8>
<link rel=preload href=/ThysbelonTitle.svg as=image type=image/svg+xml>
<link rel=preload href=/thysbelonicon.svg as=image type=image/svg+xml>
<link rel=preload href=/BlogStylesheet.css as=style>
<meta name="color-scheme" content="dark light"><meta name=robots content=noindex><link rel=alternate hreflang=ja href=https://thysbelon.github.io/ホーム/><title>Thysbelon</title>
<meta property="og:title" content="Thysbelon">
<meta name=theme-color content=#ff4c60>

<meta name=viewport content=width=device-width,initial-scale=1.0>
<meta name="description" content="My personal blog where I post about whatever interests me."><meta property="og:description" content="My personal blog where I post about whatever interests me."><script src=/ytvideoactivate.js></script><link rel=icon type=image/x-icon href=/thysbelonicon.svg>
<link rel=stylesheet href=/BlogStylesheet.css></head>
<body>
<header><a href=/Home><img id=blogtitle src=/ThysbelonTitle.svg alt=Thysbelon. width=1002 height=272><img src=/thysbelonicon.svg alt="Logo of a Hummingbird moth." width=280 height=280></a></header>
<nav><ul><li><a href=/About/>About</a><li><a href=/Portfolio/>Portfolio</a><li><a href=/UI-UX/>UI UX</a><li><a href=/Archive/>Archive</a><li><a href=/Subscribe/>Subscribe</a><li><details><summary>Art</summary><ul><li><a href=/Photography/>Photography</a><li><a href=/Programs/>Programs</a><li><a href=/Digital-Art/>Digital Art</a></details>
	<li><a href=/>Language/言語</a></ul></nav>
<article><h1><a href=/2023/01/19/Success-with-N64-Sequenced-Music>Success with N64 Sequenced Music</a></h1><time>19 January 2023</time><link href=/misc/headbop.css rel=stylesheet>
<a href=/2023/01/19/Success-with-N64-Sequenced-Music tabindex=-1><img class=trans src=/misc/headbopsheet.png id=bopmoth2 alt="A hummingbird moth wearing headphones."></a>
<button onclick=this.onclick=null;StartJams2() style=margin-bottom:1rem>Start Jams</button>
<p>Remember when I said I would never attempt to embed N64 sequenced music on a webpage again? I lied. I just had to give it another try! I wanted to see what kind of results I would get by using a midi extracted via <a href=https://github.com/jombo23/N64-Tools target=_blank>N64 Soundbank Tool</a>. There were some errors I had to fix, but it sounds pretty good! Not perfect, of course, but it's recognizable.
<details>
<summary>
Fixes
</summary>
<p>I had to change the sustain level of the bass instrument in the soundfont, so the sound wouldn't go quiet immediately. <a href=/2023/01/19/Success-with-N64-Sequenced-Music/../ExtractedSoundbank-instr_20-vol_envelope-sustain_level.7z>Fixed soundfont (use 7zip to extract).</a> I also added reverb.
</details>
<p>The most difficult part was recreating the reverb heard in game. I tried a bunch of weird module things, but all I really needed was to play a convolverNode reverb output <em>alongside</em> the unmodified output. <!--<br>Thank you to <a href=http://reverbjs.org/ target=_blank>Reverb.js</a> for making that even easier to do!-->
<p>(Please don't click "Start Jams" twice)
<script src=https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/externals/libfluidsynth-2.3.0-with-libsndfile.js></script><script src=https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/dist/js-synthesizer.min.js></script>
<!--<script src=http://reverbjs.org/reverb.js></script>-->
<script>
var sfontBuffer;
var smfBuffer;
var jams2;
var context = new AudioContext();

function StartJams2(){
console.log('startjams2');

(async function(){
	let response = await fetch('/2023/01/19/Success-with-N64-Sequenced-Music/../ExtractedSoundbank-instr_20-vol_envelope-sustain_level.sf3');
	sfontBuffer = await response.arrayBuffer();
	response = await fetch('/2023/01/19/Success-with-N64-Sequenced-Music/../Super Smash Bros. (U) 0000000A 00B379FC cut.mid');
	smfBuffer = await response.arrayBuffer();
})();

async function createReverb() { // from mdn
  let convolver = context.createConvolver();

  // load impulse response from file
  let response = await fetch('/misc/ElvedenHallSmokingRoom.m4a'); // from http://reverbjs.org/Library/ElvedenHallSmokingRoom.m4a
  let arraybuffer = await response.arrayBuffer();
  convolver.buffer = await context.decodeAudioData(arraybuffer);

  return convolver;
}

JSSynth.waitForReady().then(loadSynthesizer);

async function loadSynthesizer() {
	
	context.resume();
	await context.audioWorklet.addModule('https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/externals/libfluidsynth-2.3.0-with-libsndfile.js')
	await context.audioWorklet.addModule('https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/dist/js-synthesizer.worklet.min.js');
	var synth = new JSSynth.AudioWorkletNodeSynthesizer();
	synth.init(context.sampleRate);
	var audioNode = synth.createAudioNode(context);
	
	
	// goes with mdn code
	let reverb = await createReverb();
	audioNode.connect(reverb);
	//var gain = new GainNode(context,{gain:3})
	let gain = new GainNode(context,{gain:0.2});
	reverb.connect(gain);
	gain.connect(context.destination);
	audioNode.connect(context.destination);await synth.loadSFont(sfontBuffer);
	await synth.addSMFDataToPlayer(smfBuffer);
	let tempelem=document.getElementById('bopmoth2')
	await synth.playPlayer();
	tempelem.style.animation="0.75949367088607594936708860759494s step-end infinite bop"
	jams2=true
	while (jams2===true) {
		console.log("loop")
		await synth.waitForPlayerStopped()
		await synth.seekPlayer(1440)
		await synth.playPlayer();
	}
	
}

}
</script></article><article><h1><a href=/2023/01/18/Trouble-with-N64-Sequenced-Music>Trouble with N64 Sequenced Music</a></h1><time>18 January 2023</time><p>DLS files are really tough to work with. The only thing that can convert them is Viena. I've been extracting soundbanks from N64 games, but N64SoundbankTool only extracts them as DLS; so when I convert the DLS to SF2 and play it with the N64-music-converted-to-midi, I can't tell how many of the flaws are from the DLS conversion, and how many are from the N64 extraction... (They're probably the fault of the N64 extraction) <br>and I don't think I'll be able to find a way to play DLS files on...</article><article><h1><a href=/2023/01/16/Can-You-Play-Midi-with-SF2-on-the-Web>Can You Play Midi with SF2 on the Web?</a></h1><time>16 January 2023</time><link href=/misc/headbop.css rel=stylesheet>
<a href=/2023/01/16/Can-You-Play-Midi-with-SF2-on-the-Web tabindex=-1><img loading=lazy class=trans src=/misc/headbopsheet.png id=bopmoth alt="A hummingbird moth wearing headphones."></a>
<script src=https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/externals/libfluidsynth-2.3.0-with-libsndfile.js></script><script src=https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/dist/js-synthesizer.min.js></script>
<p>Yes.</p>
<button onclick=this.onclick=null;StartJams() style=margin-bottom:1rem>Start Jams</button>
<p><a href=https://github.com/jet2jet/js-synthesizer target=_blank>Thank you to jet2jet for making such an amazing tool!</a>
<script>
function StartJams(){
console.log('startjams')
var sfontBuffer;
var smfBuffer;
var context; //context.suspend() and context.resume() can be used to pause and play
var synth; //this can be used to implement Pause and Play features with synth.stopPlayer() and synth.playPlayer(). Implementing this feature would require changing the loop code from a "while true" loop to a recursive named function.
(async function(){
	let response = await fetch('/2023/01/16/Can-You-Play-Midi-with-SF2-on-the-Web/../SEQ_GS_VS_RAIKOU.sf3') // I used the linux program "sf3convert" to compress to sf3.
	sfontBuffer = await response.arrayBuffer()
	response = await fetch('/2023/01/16/Can-You-Play-Midi-with-SF2-on-the-Web/../SEQ_GS_VS_RAIKOU.mid') // extracted using the latest version of vgmtrans
	smfBuffer = await response.arrayBuffer()
})();

JSSynth.waitForReady().then(loadSynthesizer);

async function loadSynthesizer() {
	context = new AudioContext();
	await context.audioWorklet.addModule('https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/externals/libfluidsynth-2.3.0-with-libsndfile.js')
	await context.audioWorklet.addModule('https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/dist/js-synthesizer.worklet.min.js');
	// Create the synthesizer instance for AudioWorkletNode
	synth = new JSSynth.AudioWorkletNodeSynthesizer();
	synth.init(context.sampleRate);
	// You must create AudioWorkletNode before using other methods
	// (This is because the message port is not available until the
	// AudioWorkletNode is created)
	var audioNode = synth.createAudioNode(context);
	audioNode.connect(context.destination); // or another node...
	// After node creation, you can use Synthesizer methods
	await synth.loadSFont(sfontBuffer)
	await synth.addSMFDataToPlayer(smfBuffer);
	let tempelem=document.getElementById('bopmoth')
	await synth.playPlayer();
	tempelem.style.animation="0.63157894736842105263157894736842s step-end infinite bop"
	//let looptestseek= await synth.retrievePlayerTotalTicks() - 1000
	//await synth.seekPlayer(looptestseek) //test loop
	while (true) {
		console.log("loop")
		await synth.waitForPlayerStopped()
		await synth.seekPlayer(1920) //loop once. tick 0 is the beginning of the song, keep this in mind while calculating. ticks is ticks-per-quarter-note * quarter notes. find tpq by reaper right click > source properties
		await synth.playPlayer();
	}
}
}
</script>
<!--style: "midi-player::part(play-button){color:black} midi-player::part(time){color:black}"
<script src=/2023/01/16/Can-You-Play-Midi-with-SF2-on-the-Web/../"https://cdn.jsdelivr.net/combine/npm/tone@14.7.58,npm/@magenta/music@1.23.1/es6/core.js,npm/focus-visible@5,npm/html-midi-player@1.5.0"></a></script>
<midi-player sound-font src=/2023/01/16/Can-You-Play-Midi-with-SF2-on-the-Web/../Blue_Rondo_A_La_Turk.mid></midi-player>--></article><article><h1><a href=/2023/01/07/La-Follia-d'amore-Taiko-no-Tatsujin-Chart>La Follia d'amore Taiko no Tatsujin Chart</a></h1><time> 7 January 2023</time><p>I made a <a href=/2023/01/07/La-Follia-d'amore-Taiko-no-Tatsujin-Chart/../La-Follia-d'amore.zip>Taiko chart of Hyness' phase 2 battle theme (Oni and Hard difficulty only)</a>.</article><article><h1><a href=/2022/12/12/Kirby-Star-Allies-Assignment-Elements>Kirby Star Allies Assignment: Elements</a></h1><time>12 December 2022</time><p>This post contains spoilers for Kirby Star Allies. <p>When my professor spoke of what he wanted in this blog post, he talked at length about Red Dead Redemption; about how it creates an immersive experience of the Wild West that bridges the gap between fiction and reality. <p>Kirby is nothing like Red Dead Redemption. <p>There are very few Kirby games that could be described as immersive. Forgotten Land comes the closest, due to having a world modeled after Earth, and how minimalist the UI is. Kirby Canvas Curse also comes...</article><div class=pnav><a class="btnlink fli" href=/Home/page/2/>Newer Posts</a><a class="btnlink fri" href=/Home/page/4/>Older Posts</a></div>
<footer>Header font from <a href=http://velvetyne.fr/fonts/compagnon/ target=_blank>Velvetyne</a></footer>
<script src=/webpnotice.js></script></body></html>