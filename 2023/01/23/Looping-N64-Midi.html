<!DOCTYPE html>
<html lang=en>
<head>
<meta charset=UTF-8>
<link rel=preload href=/ThysbelonTitle.svg as=image type=image/svg+xml>
<link rel=preload href=/thysbelonicon.svg as=image type=image/svg+xml>
<link rel=preload href=/BlogStylesheet.css as=style>
<meta name="color-scheme" content="dark light"><title>Looping N64 Midi - Thysbelon</title>
<meta property="og:title" content="Looping N64 Midi - Thysbelon">
<meta name=theme-color content=#ff4c60>
<link rel=author href=/About/>
<meta name=viewport content=width=device-width,initial-scale=1.0>
<meta name="description" content="Start Jams The previous two N64 midis had blank space after the end of the loop, so I cut off the blank space so I could cleanly loop the song when the player stopped. However, I learned today that N64SoundbankTool exported midis will have their loop start and end points..."><meta property="og:description" content="Start Jams The previous two N64 midis had blank space after the end of the loop, so I cut off the blank space so I could cleanly loop the song when the player stopped. However, I learned today that N64SoundbankTool exported midis will have their loop start and end points..."><link rel=icon type=image/x-icon href=/thysbelonicon.svg>
<link rel=stylesheet href=/BlogStylesheet.css><meta name="og:image" content=/misc/headbopsheet.png></head>
<body>
<header><a href=/Home><img id=blogtitle src=/ThysbelonTitle.svg alt=Thysbelon. width=1002 height=272><img src=/thysbelonicon.svg alt="Logo of a Hummingbird moth." width=280 height=280></a></header>
<nav><ul><li><a href=/Subscribe/>Subscribe</a><li><a href=/Portfolio/>Portfolio</a><li><a href=/Archive/>Archive</a><li><a href=/About/>About</a><li><a href=/UI-UX/>UI UX</a><li><details><summary>Art</summary><ul><li><a href=/Programs/>Programs</a><li><a href=/Digital-Art/>Digital Art</a><li><a href=/Photography/>Photography</a></details>
	<li><a href=/>Language/言語</a></ul></nav>
<main itemscope itemtype=https://schema.org/BlogPosting>
<section>
<h1 itemprop=headline>Looping N64 Midi</h1>
<time itemprop=datePublished datetime=2023-01-23>23 January 2023</time>
<link href=/misc/headbop.css rel=stylesheet>
<img itemprop=image class=trans src=/misc/headbopsheet.png id=bopmoth4 alt="A hummingbird moth wearing headphones.">
<button onclick=this.onclick=null;StartJams4() style=margin-bottom:1rem>Start Jams</button>
<p>The previous two N64 midis had blank space after the end of the loop, so I cut off the blank space so I could cleanly loop the song when the player stopped. However, I learned today that N64SoundbankTool exported midis will have their loop start and end points marked by a CC 102 and 103 event. I used js-synthesizer's hook midi method to automatically loop the song at those positions; it was easy to do and it turned out great!
<script src=https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/externals/libfluidsynth-2.3.0-with-libsndfile.js></script><script src=https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/dist/js-synthesizer.min.js></script>
<script>
var sfontBuffer;
var smfBuffer;
var context = new AudioContext();

function StartJams4(){
console.log('startjams4');

(async function(){
	let response = await fetch('ExtractedSoundbank.sf3');
	sfontBuffer = await response.arrayBuffer();
	response = await fetch('Kirby 64 - The Crystal Shards (U) 00000007 0025C274.mid');
	smfBuffer = await response.arrayBuffer();
})();

async function createReverb() { // from mdn
  let convolver = context.createConvolver();

  // load impulse response from file
  let response = await fetch('/misc/ElvedenHallSmokingRoom.m4a'); // from http://reverbjs.org/Library/ElvedenHallSmokingRoom.m4a
  let arraybuffer = await response.arrayBuffer();
  convolver.buffer = await context.decodeAudioData(arraybuffer);

  return convolver;
}

JSSynth.waitForReady().then(loadSynthesizer);

async function loadSynthesizer() {
	
	context.resume();
	await context.audioWorklet.addModule('https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/externals/libfluidsynth-2.3.0-with-libsndfile.js')
	await context.audioWorklet.addModule('https://cdn.jsdelivr.net/npm/js-synthesizer@1.8.5/dist/js-synthesizer.worklet.min.js');
	await context.audioWorklet.addModule('/misc/N64-midi-loop.js');
	var synth = new JSSynth.AudioWorkletNodeSynthesizer();
	synth.init(context.sampleRate);
	var audioNode = synth.createAudioNode(context);
	synth.hookPlayerMIDIEventsByName('n64Loop');
	
	// goes with mdn code
	let reverb = await createReverb();
	audioNode.connect(reverb);
	//var gain = new GainNode(context,{gain:3})
	let gain = new GainNode(context,{gain:0.1});
	reverb.connect(gain);
	gain.connect(context.destination);
	audioNode.connect(context.destination);
	
	await synth.loadSFont(sfontBuffer);
	await synth.addSMFDataToPlayer(smfBuffer);
	let tempelem=document.getElementById('bopmoth4')
	await synth.playPlayer();
	tempelem.style.animation=(60/174)*2+"s step-end infinite bop"
	/*while (jams2===true) {
		console.log("loop")
		await synth.waitForPlayerStopped()
		await synth.seekPlayer(1440)
		await synth.playPlayer();
	}*/
	
}

}
</script>
</section>
<div class=tags>Tags:<ul><li><a href=/Tags/Kirby rel=tag>Kirby</a><li><a href=/Tags/Kirby-64 rel=tag>Kirby 64</a><li><a href=/Tags/N64 rel=tag>N64</a><li><a href=/Tags/Midi rel=tag>Midi</a></ul></div>
<div class=tags>Categories:<ul><li><a href=/Categories/Web-Development rel=category>Web Development</a><li><a href=/Categories/Video-Game rel=category>Video Game</a></ul></div>
</main>
<aside>
<h2>Related Posts</h2><ul class="gallery padb">




<li><a href=/2023/01/22/Redial>
Redial<br>
<p>Start Jams Today I put a midi of Redial on the web! :) To get it more accurate, I had...</p>
</a>



<li><a href=/2023/01/19/Success-with-N64-Sequenced-Music>
Success with N64 Sequenced Music<br>
<p>Start Jams Remember when I said I would never attempt to embed N64 sequenced music on a webpage again? I...</p>
</a>



<li><a href=/2023/01/18/Trouble-with-N64-Sequenced-Music>
Trouble with N64 Sequenced Music<br>
<p>DLS files are really tough to work with. The only thing that can convert them is Viena. I've been extracting...</p>
</a>



<li><a href=/2023/01/16/Can-You-Play-Midi-with-SF2-on-the-Web>
Can You Play Midi with SF2 on the Web?<br>
<p>


Yes.
Start Jams
Thank you to jet2jet for making such an amazing tool!

</p>
</a>



<li><a href=/2023/10/04/Drawcia-Sorceress-ZX-Spectrum-Beeper-Cover>
Drawcia Sorceress ZX Spectrum Beeper Cover<br>
<p>Play alternative In August, I was listening to Tim Follin's work. When I listened to Chronos on youtube, the suggested...</p>
</a>



<li><a href=/2023/01/07/La-Follia-d'amore-Taiko-no-Tatsujin-Chart>
La Follia d'amore Taiko no Tatsujin Chart<br>
<p>I made a Taiko chart of Hyness' phase 2 battle theme (Oni and Hard difficulty only).</p>
</a>



<li><a href=/2022/12/12/Kirby-Star-Allies-Assignment-Elements>
Kirby Star Allies Assignment: Elements<br>
<p>This post contains spoilers for Kirby Star Allies. When my professor spoke of what he wanted in this blog post,...</p>
</a>



<li><a href=/2022/12/06/Kirby-Star-Allies-Assignment-Art>
Kirby Star Allies Assignment: Art<br>
<p>Kirby Star Allies uses high definition 3D models for characters and environments. User interface elements use flat vector art with...</p>
</a>



<li><a href=/2022/11/22/Kirby-Star-Allies-Assignment-Audio>
Kirby Star Allies Assignment: Audio<br>
<p>I was afraid that I would have nothing to say about the sound effects (interactive audio) in KSA. Unless a...</p>
</a>



<li><a href=/2022/11/15/Kirby-Star-Allies-Assignment-Production>
Kirby Star Allies Assignment: Production<br>
<p>Kirby Star Allies was developed by HAL Laboratory and published by triple A game company Nintendo. Its game engine is...</p>
</a>



<li><a href=/2022/11/01/Kirby-Star-Allies-Assignment-Game-Mechanics>
Kirby Star Allies Assignment: Game Mechanics<br>
<p>Kirby Star Allies follows the same formula established in Super Star and refined in the previous three Kirby games. In...</p>
</a>



<li><a href=/2022/10/25/Kirby-Star-Allies-Assignment-Narrative>
Kirby Star Allies Assignment: Narrative<br>
<p>Kirby is a platforming series that focuses on being simple and fun. Story often takes a back seat. Many of...</p>
</a>



<li><a href=/2022/10/24/Kirby-Super-Star-Ultra-Everything-Unlocked-Save-File>
Kirby Super Star Ultra Everything Unlocked Save File<br>
<p>I had trouble finding a 100% save file for this game online, so I'm uploading mine! Actually, my save file...</p>
</a>



<li><a href=/2022/10/05/Top-5-Games-for-Game-Design-Class>
Top 5 Games for Game Design Class<br>
<p>I don't spend a lot of time thinking about what makes the games I play good, so I'm a bit...</p>
</a>
</ul>
</aside>
<footer>Header font from <a href=http://velvetyne.fr/fonts/compagnon/ target=_blank>Velvetyne</a></footer>
<script src=/webpnotice.js></script></body></html>